(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))h(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&h(p)}).observe(document,{childList:!0,subtree:!0});function g(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function h(o){if(o.ep)return;o.ep=!0;const c=g(o);fetch(o.href,c)}})();document.addEventListener("DOMContentLoaded",()=>{const d=document.getElementById("categories"),u=document.getElementById("comparison-area"),g=document.getElementById("search-input"),h=document.getElementById("no-item-selected"),o=document.getElementById("theme-toggle"),c=document.getElementById("light-icon"),p=document.getElementById("dark-icon"),C=document.getElementById("theme-text");let E=[],y=null;function w(){const e=localStorage.getItem("theme");e==="dark"?f():e==="light"?I():window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&f()}function f(){document.body.classList.add("dark-theme"),c.style.display="none",p.style.display="block",C.textContent="Chế độ sáng",localStorage.setItem("theme","dark")}function I(){document.body.classList.remove("dark-theme"),c.style.display="block",p.style.display="none",C.textContent="Chế độ tối",localStorage.setItem("theme","light")}o.addEventListener("click",()=>{document.body.classList.contains("dark-theme")?I():f()}),w();async function S(){try{const e=await fetch("./data.json");if(!e.ok){console.error(`Failed to fetch data.json. Status: ${e.status}, StatusText: ${e.statusText}`);const s=await e.text();throw console.error("Response body (if available):",s),new Error(`HTTP error! status: ${e.status}`)}y=await e.json(),b(y.categories),T(y.categories)}catch(e){console.error("Could not fetch data:",e),d.innerHTML=`<p style="color: red;">Lỗi tải dữ liệu (data.json). Hãy đảm bảo bạn đã chạy 'npm run scan' thành công và kiểm tra Console (F12) trong trình duyệt để biết thêm chi tiết.</p>`}}function b(e){d.innerHTML="";const s=document.createElement("ul");s.classList.add("category-tree");for(const n in e){const t=e[n];if(t.length>0){const a=document.createElement("li");a.classList.add("category-node");const r=document.createElement("span");r.textContent=n,r.classList.add("category-title"),a.appendChild(r);const i=document.createElement("ul");i.classList.add("item-list"),t.forEach(l=>{const m=document.createElement("li");m.classList.add("item-node"),m.textContent=`${l.id?l.id+" - ":""}${l.name}`,m.dataset.category=n,m.dataset.itemId=l.id||l.name.replace(/ /g,"_"),m.addEventListener("click",L=>{L.stopPropagation(),k(l)}),i.appendChild(m)}),a.appendChild(i),r.addEventListener("click",()=>{a.classList.toggle("expanded")}),s.appendChild(a)}}d.appendChild(s)}function T(e){E=[];for(const s in e)e[s].forEach(n=>{E.push(n)})}function k(e){u.innerHTML="",h&&(h.style.display="none");const s=x("MU Awaken",e.images.awaken),n=x("MU Origin",e.images.origin);u.appendChild(s),u.appendChild(n),M(e.category,e.id||e.name.replace(/ /g,"_"))}function x(e,s){const n=document.createElement("div");n.classList.add("image-container");const t=document.createElement("h4");if(t.textContent=e,n.appendChild(t),s.length>0)s.forEach(a=>{const r=document.createElement("div");r.classList.add("image-preview-container"),n.appendChild(r);const i=document.createElement("img");i.src=`./${a}`,i.alt=`${e} image`,r.appendChild(i)});else{const a=document.createElement("p");a.textContent="Không có hình ảnh.",n.appendChild(a)}return n}function M(e,s){const n=d.querySelector(".selected-item");n&&n.classList.remove("selected-item");const t=d.querySelector(`.item-node[data-category="${e}"][data-item-id="${s}"]`);if(t){t.classList.add("selected-item");const a=t.closest(".category-node");a&&!a.classList.contains("expanded")&&a.classList.add("expanded")}}function $(){const e=g.value.toLowerCase().trim(),s=d.querySelectorAll(".category-node"),n=d.querySelectorAll(".item-node");if(e===""){n.forEach(t=>t.style.display="list-item"),s.forEach(t=>{t.style.display="list-item",t.classList.remove("expanded")});return}s.forEach(t=>{const r=t.querySelector(".item-list").querySelectorAll(".item-node");let i=!1;r.forEach(l=>{const m=l.textContent.toLowerCase(),L=l.dataset.itemId.toLowerCase(),v=m.includes(e)||L.includes(e);l.style.display=v?"list-item":"none",v&&(i=!0)}),t.style.display=i?"list-item":"none",i?t.classList.add("expanded"):t.classList.remove("expanded")})}g.addEventListener("input",$),S()});
