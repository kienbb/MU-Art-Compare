(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))y(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&y(g)}).observe(document,{childList:!0,subtree:!0});function L(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function y(c){if(c.ep)return;c.ep=!0;const d=L(c);fetch(c.href,d)}})();document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("categories");document.getElementById("comparison-area");const h=document.getElementById("search-input");document.getElementById("no-item-selected");const L=document.getElementById("theme-toggle"),y=document.getElementById("light-icon"),c=document.getElementById("dark-icon"),d=document.getElementById("theme-text");let g=[],C=null;const r=document.createElement("div");r.className="popup-overlay",r.innerHTML=`
        <div class="popup-content">
            <button class="popup-close">×</button>
            <img class="popup-image" src="" alt="Enlarged image">
        </div>
    `,document.body.appendChild(r);const k=r.querySelector(".popup-image"),w=r.querySelector(".popup-close");function x(e){k.src=e,r.classList.add("active"),document.body.style.overflow="hidden"}function E(){r.classList.remove("active"),document.body.style.overflow=""}w.addEventListener("click",E),r.addEventListener("click",e=>{e.target===r&&E()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&r.classList.contains("active")&&E()});function S(){const e=localStorage.getItem("theme");e==="dark"?v():e==="light"?I():window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&v()}function v(){document.body.classList.add("dark-theme"),y.style.display="none",c.style.display="block",d.textContent="Chế độ sáng",localStorage.setItem("theme","dark")}function I(){document.body.classList.remove("dark-theme"),y.style.display="block",c.style.display="none",d.textContent="Chế độ tối",localStorage.setItem("theme","light")}L.addEventListener("click",()=>{document.body.classList.contains("dark-theme")?I():v()}),S();async function M(){try{const e="https://raw.githubusercontent.com/kienbb/MU-Art-Compare/main/docs/data.json";console.log("Fetching data directly from GitHub:",e);const n=await fetch(e);if(!n.ok)throw console.error(`Failed to fetch from GitHub raw. Status: ${n.status}`),new Error(`HTTP error! status: ${n.status}`);C=await n.json(),T(C.categories),B(C.categories)}catch(e){console.error("Could not fetch data:",e),m.innerHTML='<p style="color: red;">Lỗi tải dữ liệu. Vui lòng kiểm tra kết nối mạng và thử lại.</p>'}}function T(e){m.innerHTML="";const n=document.createElement("ul");n.classList.add("category-tree");const i=document.getElementById("content");if(i.innerHTML=`
            <div class="content-header">
                <h2>So sánh chi tiết</h2>
            </div>
            <div class="content-body">
                <div id="comparison-area">
                    <p id="no-item-selected">Chọn một mục từ danh sách bên trái để xem so sánh.</p>
                </div>
            </div>
        `,!e||Object.keys(e).length===0){const t=document.createElement("p");t.textContent='Không có dữ liệu danh mục. Vui lòng thêm dữ liệu vào thư mục assets và chạy "npm run scan".',t.style.color="red",m.appendChild(t);return}for(const t in e){const s=e[t];if(s&&s.length>0){const o=document.createElement("li");o.classList.add("category-node");const a=document.createElement("span");a.textContent=t,a.classList.add("category-title"),o.appendChild(a);const l=document.createElement("ul");l.classList.add("item-list"),s.forEach(u=>{const p=document.createElement("li");p.classList.add("item-node"),p.textContent=`${u.id?u.id+" - ":""}${u.name}`,p.dataset.category=t,p.dataset.itemId=u.id||u.name.replace(/ /g,"_"),p.addEventListener("click",f=>{f.stopPropagation(),q(u)}),l.appendChild(p)}),o.appendChild(l),a.addEventListener("click",()=>{o.classList.toggle("expanded")}),n.appendChild(o)}else{const o=document.createElement("li");o.classList.add("category-node");const a=document.createElement("span");a.textContent=t,a.classList.add("category-title"),o.appendChild(a);const l=document.createElement("p");l.textContent="Không có mục nào trong danh mục này",l.style.fontSize="0.9em",l.style.fontStyle="italic",l.style.marginLeft="20px",o.appendChild(l),n.appendChild(o)}}m.appendChild(n)}function B(e){g=[];for(const n in e)e[n].forEach(i=>{g.push(i)})}function q(e){const n=document.getElementById("comparison-area");n.innerHTML="";const i=document.querySelector(".content-header h2");i.textContent=`So sánh chi tiết - ${e.id?e.id+" - ":""}${e.name}`;const t=b("MU Awaken",e.images.awaken),s=b("MU Origin",e.images.origin);n.appendChild(t),n.appendChild(s),O(e)}function b(e,n){const i=document.createElement("div");i.classList.add("image-container");const t=document.createElement("h4");if(t.textContent=e,i.appendChild(t),n.length>0)n.forEach(s=>{const o=document.createElement("div");o.classList.add("image-preview-container"),i.appendChild(o);const a=document.createElement("img");a.src=s,a.alt=`${e} image`,o.addEventListener("click",()=>{x(s)}),o.appendChild(a)});else{const s=document.createElement("p");s.textContent="Không có hình ảnh.",i.appendChild(s)}return i}function O(e){const n=m.querySelector(".selected-item");n&&n.classList.remove("selected-item");const i=`${e.id?e.id+" - ":""}${e.name}`,t=m.querySelectorAll(".item-node");for(const s of t)if(s.textContent===i&&s.dataset.category===e.category){s.classList.add("selected-item");const o=s.closest(".category-node");o&&o.classList.add("expanded");break}}function A(){const e=h.value.toLowerCase().trim(),n=m.querySelectorAll(".category-node"),i=m.querySelectorAll(".item-node");if(e===""){i.forEach(t=>t.style.display="list-item"),n.forEach(t=>{t.style.display="list-item",t.classList.remove("expanded")});return}n.forEach(t=>{const o=t.querySelector(".item-list").querySelectorAll(".item-node");let a=!1;o.forEach(l=>{const u=l.textContent.toLowerCase(),p=l.dataset.itemId.toLowerCase(),f=u.includes(e)||p.includes(e);l.style.display=f?"list-item":"none",f&&(a=!0)}),t.style.display=a?"list-item":"none",a?t.classList.add("expanded"):t.classList.remove("expanded")})}h.addEventListener("input",A),M()});
