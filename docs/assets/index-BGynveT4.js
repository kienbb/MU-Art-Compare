(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))g(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&g(h)}).observe(document,{childList:!0,subtree:!0});function f(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function g(c){if(c.ep)return;c.ep=!0;const i=f(c);fetch(c.href,i)}})();document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("categories"),u=document.getElementById("comparison-area"),f=document.getElementById("search-input"),g=document.getElementById("no-item-selected"),c=document.getElementById("theme-toggle"),i=document.getElementById("light-icon"),h=document.getElementById("dark-icon"),C=document.getElementById("theme-text");let E=[],p=null;function S(){const t=localStorage.getItem("theme");t==="dark"?y():t==="light"?I():window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&y()}function y(){document.body.classList.add("dark-theme"),i.style.display="none",h.style.display="block",C.textContent="Chế độ sáng",localStorage.setItem("theme","dark")}function I(){document.body.classList.remove("dark-theme"),i.style.display="block",h.style.display="none",C.textContent="Chế độ tối",localStorage.setItem("theme","light")}c.addEventListener("click",()=>{document.body.classList.contains("dark-theme")?I():y()}),S();async function M(){try{const t=document.baseURI?new URL("./",document.baseURI).href:"/",a=new URL("data.json",t).href;console.log("Attempting to fetch data from primary location:",a);try{const e=await fetch(a);if(e.ok){p=await e.json(),w(p.categories),b(p.categories);return}console.error(`Failed to fetch from primary location. Status: ${e.status}`)}catch(e){console.error("Error with primary fetch:",e)}const n=["/MU-Art-Compare/data.json","./data.json","../data.json","https://raw.githubusercontent.com/kienbb/MU-Art-Compare/main/docs/data.json"];for(const e of n){console.log(`Attempting alternative location: ${e}`);try{const o=await fetch(e);if(o.ok){console.log(`Successfully loaded data from: ${e}`),p=await o.json(),w(p.categories),b(p.categories);return}}catch(o){console.error(`Error with alternative fetch from ${e}:`,o)}}throw new Error("Failed to fetch data from all locations")}catch(t){console.error("Could not fetch data:",t),m.innerHTML=`<p style="color: red;">Lỗi tải dữ liệu (data.json). Hãy đảm bảo bạn đã chạy 'npm run scan' thành công và kiểm tra Console (F12) trong trình duyệt để biết thêm chi tiết.</p>`}}function w(t){m.innerHTML="";const a=document.createElement("ul");if(a.classList.add("category-tree"),!t||Object.keys(t).length===0){const n=document.createElement("p");n.textContent='Không có dữ liệu danh mục. Vui lòng thêm dữ liệu vào thư mục assets và chạy "npm run scan".',n.style.color="red",m.appendChild(n);return}for(const n in t){const e=t[n];if(e&&e.length>0){const o=document.createElement("li");o.classList.add("category-node");const r=document.createElement("span");r.textContent=n,r.classList.add("category-title"),o.appendChild(r);const s=document.createElement("ul");s.classList.add("item-list"),e.forEach(l=>{const d=document.createElement("li");d.classList.add("item-node"),d.textContent=`${l.id?l.id+" - ":""}${l.name}`,d.dataset.category=n,d.dataset.itemId=l.id||l.name.replace(/ /g,"_"),d.addEventListener("click",L=>{L.stopPropagation(),k(l)}),s.appendChild(d)}),o.appendChild(s),r.addEventListener("click",()=>{o.classList.toggle("expanded")}),a.appendChild(o)}else{const o=document.createElement("li");o.classList.add("category-node");const r=document.createElement("span");r.textContent=n,r.classList.add("category-title"),o.appendChild(r);const s=document.createElement("p");s.textContent="Không có mục nào trong danh mục này",s.style.fontSize="0.9em",s.style.fontStyle="italic",s.style.marginLeft="20px",o.appendChild(s),a.appendChild(o)}}m.appendChild(a)}function b(t){E=[];for(const a in t)t[a].forEach(n=>{E.push(n)})}function k(t){u.innerHTML="",g&&(g.style.display="none");const a=v("MU Awaken",t.images.awaken),n=v("MU Origin",t.images.origin);u.appendChild(a),u.appendChild(n),U(t.category,t.id||t.name.replace(/ /g,"_"))}function v(t,a){const n=document.createElement("div");n.classList.add("image-container");const e=document.createElement("h4");e.textContent=t,n.appendChild(e);const o=document.baseURI?new URL("./",document.baseURI).href:"/";if(a.length>0)a.forEach(r=>{const s=document.createElement("div");s.classList.add("image-preview-container"),n.appendChild(s);const l=document.createElement("img"),d=new URL(r,o).href;l.src=d,l.alt=`${t} image`,s.appendChild(l)});else{const r=document.createElement("p");r.textContent="Không có hình ảnh.",n.appendChild(r)}return n}function U(t,a){const n=m.querySelector(".selected-item");n&&n.classList.remove("selected-item");const e=m.querySelector(`.item-node[data-category="${t}"][data-item-id="${a}"]`);if(e){e.classList.add("selected-item");const o=e.closest(".category-node");o&&!o.classList.contains("expanded")&&o.classList.add("expanded")}}function T(){const t=f.value.toLowerCase().trim(),a=m.querySelectorAll(".category-node"),n=m.querySelectorAll(".item-node");if(t===""){n.forEach(e=>e.style.display="list-item"),a.forEach(e=>{e.style.display="list-item",e.classList.remove("expanded")});return}a.forEach(e=>{const r=e.querySelector(".item-list").querySelectorAll(".item-node");let s=!1;r.forEach(l=>{const d=l.textContent.toLowerCase(),L=l.dataset.itemId.toLowerCase(),x=d.includes(t)||L.includes(t);l.style.display=x?"list-item":"none",x&&(s=!0)}),e.style.display=s?"list-item":"none",s?e.classList.add("expanded"):e.classList.remove("expanded")})}f.addEventListener("input",T),M()});
