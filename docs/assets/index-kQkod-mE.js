(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))h(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const p of r.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&h(p)}).observe(document,{childList:!0,subtree:!0});function g(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function h(s){if(s.ep)return;s.ep=!0;const r=g(s);fetch(s.href,r)}})();document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("categories"),u=document.getElementById("comparison-area"),g=document.getElementById("search-input"),h=document.getElementById("no-item-selected"),s=document.getElementById("theme-toggle"),r=document.getElementById("light-icon"),p=document.getElementById("dark-icon"),C=document.getElementById("theme-text");let E=[],y=null;function v(){const e=localStorage.getItem("theme");e==="dark"?f():e==="light"?I():window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&f()}function f(){document.body.classList.add("dark-theme"),r.style.display="none",p.style.display="block",C.textContent="Chế độ sáng",localStorage.setItem("theme","dark")}function I(){document.body.classList.remove("dark-theme"),r.style.display="block",p.style.display="none",C.textContent="Chế độ tối",localStorage.setItem("theme","light")}s.addEventListener("click",()=>{document.body.classList.contains("dark-theme")?I():f()}),v();async function x(){try{const e="https://raw.githubusercontent.com/kienbb/MU-Art-Compare/main/docs/data.json";console.log("Fetching data directly from GitHub:",e);const n=await fetch(e);if(!n.ok)throw console.error(`Failed to fetch from GitHub raw. Status: ${n.status}`),new Error(`HTTP error! status: ${n.status}`);y=await n.json(),S(y.categories),k(y.categories)}catch(e){console.error("Could not fetch data:",e),m.innerHTML='<p style="color: red;">Lỗi tải dữ liệu. Vui lòng kiểm tra kết nối mạng và thử lại.</p>'}}function S(e){m.innerHTML="";const n=document.createElement("ul");if(n.classList.add("category-tree"),!e||Object.keys(e).length===0){const t=document.createElement("p");t.textContent='Không có dữ liệu danh mục. Vui lòng thêm dữ liệu vào thư mục assets và chạy "npm run scan".',t.style.color="red",m.appendChild(t);return}for(const t in e){const o=e[t];if(o&&o.length>0){const c=document.createElement("li");c.classList.add("category-node");const i=document.createElement("span");i.textContent=t,i.classList.add("category-title"),c.appendChild(i);const a=document.createElement("ul");a.classList.add("item-list"),o.forEach(l=>{const d=document.createElement("li");d.classList.add("item-node"),d.textContent=`${l.id?l.id+" - ":""}${l.name}`,d.dataset.category=t,d.dataset.itemId=l.id||l.name.replace(/ /g,"_"),d.addEventListener("click",L=>{L.stopPropagation(),M(l)}),a.appendChild(d)}),c.appendChild(a),i.addEventListener("click",()=>{c.classList.toggle("expanded")}),n.appendChild(c)}else{const c=document.createElement("li");c.classList.add("category-node");const i=document.createElement("span");i.textContent=t,i.classList.add("category-title"),c.appendChild(i);const a=document.createElement("p");a.textContent="Không có mục nào trong danh mục này",a.style.fontSize="0.9em",a.style.fontStyle="italic",a.style.marginLeft="20px",c.appendChild(a),n.appendChild(c)}}m.appendChild(n)}function k(e){E=[];for(const n in e)e[n].forEach(t=>{E.push(t)})}function M(e){u.innerHTML="",h&&(h.style.display="none");const n=w("MU Awaken",e.images.awaken),t=w("MU Origin",e.images.origin);u.appendChild(n),u.appendChild(t),T(e.category,e.id||e.name.replace(/ /g,"_"))}function w(e,n){const t=document.createElement("div");t.classList.add("image-container");const o=document.createElement("h4");o.textContent=e,t.appendChild(o);const c=document.baseURI?new URL("./",document.baseURI).href:"/";if(n.length>0)n.forEach(i=>{const a=document.createElement("div");a.classList.add("image-preview-container"),t.appendChild(a);const l=document.createElement("img"),d=new URL(i,c).href;l.src=d,l.alt=`${e} image`,a.appendChild(l)});else{const i=document.createElement("p");i.textContent="Không có hình ảnh.",t.appendChild(i)}return t}function T(e,n){const t=m.querySelector(".selected-item");t&&t.classList.remove("selected-item");const o=m.querySelector(`.item-node[data-category="${e}"][data-item-id="${n}"]`);if(o){o.classList.add("selected-item");const c=o.closest(".category-node");c&&!c.classList.contains("expanded")&&c.classList.add("expanded")}}function U(){const e=g.value.toLowerCase().trim(),n=m.querySelectorAll(".category-node"),t=m.querySelectorAll(".item-node");if(e===""){t.forEach(o=>o.style.display="list-item"),n.forEach(o=>{o.style.display="list-item",o.classList.remove("expanded")});return}n.forEach(o=>{const i=o.querySelector(".item-list").querySelectorAll(".item-node");let a=!1;i.forEach(l=>{const d=l.textContent.toLowerCase(),L=l.dataset.itemId.toLowerCase(),b=d.includes(e)||L.includes(e);l.style.display=b?"list-item":"none",b&&(a=!0)}),o.style.display=a?"list-item":"none",a?o.classList.add("expanded"):o.classList.remove("expanded")})}g.addEventListener("input",U),x()});
