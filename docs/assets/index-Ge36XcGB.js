(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))p(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&p(h)}).observe(document,{childList:!0,subtree:!0});function g(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function p(s){if(s.ep)return;s.ep=!0;const r=g(s);fetch(s.href,r)}})();document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("categories"),u=document.getElementById("comparison-area"),g=document.getElementById("search-input"),p=document.getElementById("no-item-selected"),s=document.getElementById("theme-toggle"),r=document.getElementById("light-icon"),h=document.getElementById("dark-icon"),C=document.getElementById("theme-text");let E=[],y=null;function w(){const t=localStorage.getItem("theme");t==="dark"?f():t==="light"?I():window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&f()}function f(){document.body.classList.add("dark-theme"),r.style.display="none",h.style.display="block",C.textContent="Chế độ sáng",localStorage.setItem("theme","dark")}function I(){document.body.classList.remove("dark-theme"),r.style.display="block",h.style.display="none",C.textContent="Chế độ tối",localStorage.setItem("theme","light")}s.addEventListener("click",()=>{document.body.classList.contains("dark-theme")?I():f()}),w();async function v(){try{const t=document.baseURI?new URL("./",document.baseURI).href:"/",o=new URL("data.json",t).href;console.log("Attempting to fetch data from:",o);const e=await fetch(o);if(!e.ok){console.error(`Failed to fetch data.json. Status: ${e.status}, StatusText: ${e.statusText}`);const n=await e.text();throw console.error("Response body (if available):",n),new Error(`HTTP error! status: ${e.status}`)}y=await e.json(),S(y.categories),T(y.categories)}catch(t){console.error("Could not fetch data:",t),m.innerHTML=`<p style="color: red;">Lỗi tải dữ liệu (data.json). Hãy đảm bảo bạn đã chạy 'npm run scan' thành công và kiểm tra Console (F12) trong trình duyệt để biết thêm chi tiết.</p>`}}function S(t){m.innerHTML="";const o=document.createElement("ul");if(o.classList.add("category-tree"),!t||Object.keys(t).length===0){const e=document.createElement("p");e.textContent='Không có dữ liệu danh mục. Vui lòng thêm dữ liệu vào thư mục assets và chạy "npm run scan".',e.style.color="red",m.appendChild(e);return}for(const e in t){const n=t[e];if(n&&n.length>0){const a=document.createElement("li");a.classList.add("category-node");const i=document.createElement("span");i.textContent=e,i.classList.add("category-title"),a.appendChild(i);const c=document.createElement("ul");c.classList.add("item-list"),n.forEach(l=>{const d=document.createElement("li");d.classList.add("item-node"),d.textContent=`${l.id?l.id+" - ":""}${l.name}`,d.dataset.category=e,d.dataset.itemId=l.id||l.name.replace(/ /g,"_"),d.addEventListener("click",L=>{L.stopPropagation(),M(l)}),c.appendChild(d)}),a.appendChild(c),i.addEventListener("click",()=>{a.classList.toggle("expanded")}),o.appendChild(a)}else{const a=document.createElement("li");a.classList.add("category-node");const i=document.createElement("span");i.textContent=e,i.classList.add("category-title"),a.appendChild(i);const c=document.createElement("p");c.textContent="Không có mục nào trong danh mục này",c.style.fontSize="0.9em",c.style.fontStyle="italic",c.style.marginLeft="20px",a.appendChild(c),o.appendChild(a)}}m.appendChild(o)}function T(t){E=[];for(const o in t)t[o].forEach(e=>{E.push(e)})}function M(t){u.innerHTML="",p&&(p.style.display="none");const o=x("MU Awaken",t.images.awaken),e=x("MU Origin",t.images.origin);u.appendChild(o),u.appendChild(e),k(t.category,t.id||t.name.replace(/ /g,"_"))}function x(t,o){const e=document.createElement("div");e.classList.add("image-container");const n=document.createElement("h4");n.textContent=t,e.appendChild(n);const a=document.baseURI?new URL("./",document.baseURI).href:"/";if(o.length>0)o.forEach(i=>{const c=document.createElement("div");c.classList.add("image-preview-container"),e.appendChild(c);const l=document.createElement("img"),d=new URL(i,a).href;l.src=d,l.alt=`${t} image`,c.appendChild(l)});else{const i=document.createElement("p");i.textContent="Không có hình ảnh.",e.appendChild(i)}return e}function k(t,o){const e=m.querySelector(".selected-item");e&&e.classList.remove("selected-item");const n=m.querySelector(`.item-node[data-category="${t}"][data-item-id="${o}"]`);if(n){n.classList.add("selected-item");const a=n.closest(".category-node");a&&!a.classList.contains("expanded")&&a.classList.add("expanded")}}function U(){const t=g.value.toLowerCase().trim(),o=m.querySelectorAll(".category-node"),e=m.querySelectorAll(".item-node");if(t===""){e.forEach(n=>n.style.display="list-item"),o.forEach(n=>{n.style.display="list-item",n.classList.remove("expanded")});return}o.forEach(n=>{const i=n.querySelector(".item-list").querySelectorAll(".item-node");let c=!1;i.forEach(l=>{const d=l.textContent.toLowerCase(),L=l.dataset.itemId.toLowerCase(),b=d.includes(t)||L.includes(t);l.style.display=b?"list-item":"none",b&&(c=!0)}),n.style.display=c?"list-item":"none",c?n.classList.add("expanded"):n.classList.remove("expanded")})}g.addEventListener("input",U),v()});
