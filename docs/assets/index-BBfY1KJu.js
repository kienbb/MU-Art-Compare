(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))h(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&h(p)}).observe(document,{childList:!0,subtree:!0});function g(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function h(c){if(c.ep)return;c.ep=!0;const i=g(c);fetch(c.href,i)}})();document.addEventListener("DOMContentLoaded",()=>{const d=document.getElementById("categories"),u=document.getElementById("comparison-area"),g=document.getElementById("search-input"),h=document.getElementById("no-item-selected"),c=document.getElementById("theme-toggle"),i=document.getElementById("light-icon"),p=document.getElementById("dark-icon"),C=document.getElementById("theme-text");let E=[],y=null;function w(){const e=localStorage.getItem("theme");e==="dark"?f():e==="light"?I():window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&f()}function f(){document.body.classList.add("dark-theme"),i.style.display="none",p.style.display="block",C.textContent="Chế độ sáng",localStorage.setItem("theme","dark")}function I(){document.body.classList.remove("dark-theme"),i.style.display="block",p.style.display="none",C.textContent="Chế độ tối",localStorage.setItem("theme","light")}c.addEventListener("click",()=>{document.body.classList.contains("dark-theme")?I():f()}),w();async function S(){try{const e="https://raw.githubusercontent.com/kienbb/MU-Art-Compare/main/docs/data.json";console.log("Fetching data directly from GitHub:",e);const n=await fetch(e);if(!n.ok)throw console.error(`Failed to fetch from GitHub raw. Status: ${n.status}`),new Error(`HTTP error! status: ${n.status}`);y=await n.json(),b(y.categories),k(y.categories)}catch(e){console.error("Could not fetch data:",e),d.innerHTML='<p style="color: red;">Lỗi tải dữ liệu. Vui lòng kiểm tra kết nối mạng và thử lại.</p>'}}function b(e){d.innerHTML="";const n=document.createElement("ul");if(n.classList.add("category-tree"),!e||Object.keys(e).length===0){const t=document.createElement("p");t.textContent='Không có dữ liệu danh mục. Vui lòng thêm dữ liệu vào thư mục assets và chạy "npm run scan".',t.style.color="red",d.appendChild(t);return}for(const t in e){const o=e[t];if(o&&o.length>0){const s=document.createElement("li");s.classList.add("category-node");const r=document.createElement("span");r.textContent=t,r.classList.add("category-title"),s.appendChild(r);const a=document.createElement("ul");a.classList.add("item-list"),o.forEach(l=>{const m=document.createElement("li");m.classList.add("item-node"),m.textContent=`${l.id?l.id+" - ":""}${l.name}`,m.dataset.category=t,m.dataset.itemId=l.id||l.name.replace(/ /g,"_"),m.addEventListener("click",L=>{L.stopPropagation(),M(l)}),a.appendChild(m)}),s.appendChild(a),r.addEventListener("click",()=>{s.classList.toggle("expanded")}),n.appendChild(s)}else{const s=document.createElement("li");s.classList.add("category-node");const r=document.createElement("span");r.textContent=t,r.classList.add("category-title"),s.appendChild(r);const a=document.createElement("p");a.textContent="Không có mục nào trong danh mục này",a.style.fontSize="0.9em",a.style.fontStyle="italic",a.style.marginLeft="20px",s.appendChild(a),n.appendChild(s)}}d.appendChild(n)}function k(e){E=[];for(const n in e)e[n].forEach(t=>{E.push(t)})}function M(e){u.innerHTML="",h&&(h.style.display="none");const n=v("MU Awaken",e.images.awaken),t=v("MU Origin",e.images.origin);u.appendChild(n),u.appendChild(t),T(e.category,e.id||e.name.replace(/ /g,"_"))}function v(e,n){const t=document.createElement("div");t.classList.add("image-container");const o=document.createElement("h4");if(o.textContent=e,t.appendChild(o),n.length>0)n.forEach(s=>{const r=document.createElement("div");r.classList.add("image-preview-container"),t.appendChild(r);const a=document.createElement("img");a.src=s,a.alt=`${e} image`,r.appendChild(a)});else{const s=document.createElement("p");s.textContent="Không có hình ảnh.",t.appendChild(s)}return t}function T(e,n){const t=d.querySelector(".selected-item");t&&t.classList.remove("selected-item");const o=d.querySelector(`.item-node[data-category="${e}"][data-item-id="${n}"]`);if(o){o.classList.add("selected-item");const s=o.closest(".category-node");s&&!s.classList.contains("expanded")&&s.classList.add("expanded")}}function O(){const e=g.value.toLowerCase().trim(),n=d.querySelectorAll(".category-node"),t=d.querySelectorAll(".item-node");if(e===""){t.forEach(o=>o.style.display="list-item"),n.forEach(o=>{o.style.display="list-item",o.classList.remove("expanded")});return}n.forEach(o=>{const r=o.querySelector(".item-list").querySelectorAll(".item-node");let a=!1;r.forEach(l=>{const m=l.textContent.toLowerCase(),L=l.dataset.itemId.toLowerCase(),x=m.includes(e)||L.includes(e);l.style.display=x?"list-item":"none",x&&(a=!0)}),o.style.display=a?"list-item":"none",a?o.classList.add("expanded"):o.classList.remove("expanded")})}g.addEventListener("input",O),S()});
